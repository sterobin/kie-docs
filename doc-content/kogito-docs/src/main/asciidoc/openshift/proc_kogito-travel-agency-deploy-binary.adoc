[id='proc_kogito-travel-agency-deploy-binary']

= Deploying the travel agency services on OpenShift using a binary build

OpenShift builds can require extensive amounts of time. As a faster alternative for building and deploying your {PRODUCT} services on OpenShift, you can use a binary build. In a binary build, you build the application locally and push the built application to the an OpenShift `BuildConfig` configuration to be packaged into the runtime container image.

The travel agency example application includes a `BuildConfig` configuration to support a binary build in addition to traditional building for deployment.

[NOTE]
====
{PRODUCT} also supports Source-to-Image (S2I) builds, which build the application in an OpenShift build and then pass the built application to the next OpenShift build to be packaged into the runtime container image. The {PRODUCT} S2I build configuration also enables you to build the project directly from a Git repository on the OpenShift platform.

However, this example uses the local applications to demonstrate how to prepare the {PRODUCT} project on a development machine for a direct push to the cloud.
====

.Procedure
. In a command terminal, navigate to the `06-kogito-travel-agency` directory in your local travel agency tutorial Git repository and build the project using Maven:
+
--
.Building the local travel agency project
[source]
----
$ cd 06-kogito-travel-agency
$ mvn clean package
----

This command builds the project in standard JDK mode to package the application as a runner JAR file and include any dependencies in a `libs` folder.

Alternatively, you can also build the project in native mode (requires GraalVM and SubstrateVM) to build and compile the application into a native executable for your system.
--
. Navigate to the generated `target` folder and verify the following resources:

* `kogito-travel-agency-1.0-SNAPSHOT.jar`: Standard JAR file with only the classes and resources of the project.
* `kogito-travel-agency-1.0-SNAPSHOT-runner.jar`: Executable JAR file for the project. Note that this is not an uber-JAR file because the dependencies are copied into the `target/lib` directory.
* `lib`: Directory with project dependencies.
. In the generated `target` folder, enter the following command to deploy the travel agency application to OpenShift using a binary build:
+
--
.Deploying to OpenShift using binary build
[source]
----
$ oc start-build kogito-travel-agency --from-dir=target
Output
Uploading directory "/target" as binary input for the build ...
....
Uploading finished
build.build.openshift.io/kogito-travel-agency-1 started
----

You can use the following command to check the logs of the builder pod if needed:

.Checking logs of builder pod
[source]
----
$ oc logs -f build/kogito-travel-agency-1
----

After the binary build is complete, the result is pushed to the `kogito-travel-agency` Image Stream that was created by the {PRODUCT} Operator and triggers a new deployment.
--
. In the OpenShift web console, use the left menu to navigate to the following windows to verify the deployed service:
+
--
* *Workloads* -> *Deployment Configs*: Select the `kogito-travel-agency` deployment to view the application deployment configurations, pod status, and other details.
+
.Travel agency deployment details
image::kogito/kogito-ocp-app-deployment-details-agency.png[Image of travel agency service deployment details page in web console]
* *Networking* -> *Routes*: Select the *Location* URL for the `kogito-travel-agency` route to view the main page of the {PRODUCT} travel agency application:
+
.Travel agency application interface
image::kogito/kogito-ocp-travel-agency-app.png[Image of Travel Agency application main page]

After you verify that the travel agency application is deployed, you repeat the same steps to deploy the visas application.
--
. In a command terminal, navigate to the `06-kogito-visas` directory in your local travel agency tutorial Git repository and build the project using Maven:
+
--
.Building the local visas project
[source]
----
$ cd 06-kogito-visas
$ mvn clean package
----
--
. Navigate to the generated `target` folder and enter the following command to deploy the visas application to OpenShift using a binary build:
+
--
.Deploying to OpenShift using binary build
[source]
----
$ oc start-build kogito-visas --from-dir=target
Output
Uploading directory "target" as binary input for the build ...
....
Uploading finished
build.build.openshift.io/kogito-visas-1 started
----

You can use the following command to check the logs of the builder pod if needed:

.Checking logs of builder pod
[source]
----
$ oc logs -f build/kogito-visas-1
----

After the binary build is complete, the result is pushed to the `kogito-visas` Image Stream that was created by the {PRODUCT} Operator and triggers a new deployment.
--
. In the OpenShift web console, use the left menu to navigate to the following windows to verify the deployed service:
+
--
* *Workloads* -> *Deployment Configs*: Select the `kogito-visas` deployment to view the application deployment configurations, pod status, and other details.
+
.Visas deployment details
image::kogito/kogito-ocp-app-deployment-details-visas.png[Image of visas service deployment details page in web console]
* *Networking* -> *Routes*: Select the *Location* URL for the `kogito-visas` route to view the main page of the {PRODUCT} visas application:
+
.Visas application interface
image::kogito/kogito-ocp-visas-app.png[Image of Visas application main page]

To test the deployed applications, interact with the application interfaces to create a new travel plan, or use a REST client or curl command to send a REST request, such as the following example request body:

.Example REST request body to add a traveler and trip
[source,json]
----
{
  "traveller": {
    "firstName": "Jan",
    "lastName": "Kowalski",
    "email": "jan@email.com",
    "nationality": "Polish",
    "address": {
      "street": "Polna",
      "city": "Krakow",
      "zipCode": "32-000",
      "country": "Poland"
    }
  },
  "trip": {
    "country": "US",
    "city": "New York",
    "begin": "2019-11-04T00:00:00.000+02:00",
    "end": "2019-11-07T00:00:00.000+02:00"
  }
}
----
--
